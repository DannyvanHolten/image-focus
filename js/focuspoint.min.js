!function(t,e){"use strict";e.IFA={Models:{},Collections:{},Views:{}},IFA.Models.FocusPoint=Backbone.Model.extend({attachment:{_id:!1,_width:!1,_height:!1,_offset:{x:!1,y:!1},_focusPoint:{x:50,y:50}},initialize:function(){console.log("init")}}),IFA.Views.FocusPoint=Backbone.View.extend({initialize:function(){this.template=wp.template("IFA-focus-point"),this.elHtml=this.el.outerHTML,this.$el.parent().css({border:"5px solid #f09"}),this.$el.parent().replaceChild(this.template({imageObject:this.elHtml}),this.el),this.model.on("change",this.render)},render:function(){console.log("render the view"),console.log(this.template({imageObject:this.el.outerHTML})),this.$el.html(this.template({imageObject:this.el.outerHTML}))}}),t(document).on("ready",function(){setInterval(function(){var e=t(".attachment-details").find(".details-image");e.length&&!t(".image-focus").length&&e.each(function(){t(this).addClass("image-focus");var e=new IFA.Models.FocusPoint({el:this});new IFA.Views.FocusPoint({el:this,model:e}).render()})},500)})}(jQuery,window),function(t,e,a){"use strict";var o={_imageFocus:"image-focus",imageFocus:{_wrapper:"image-focus__wrapper",_img:"image-focus__img",_point:"image-focus__point",_clickarea:"image-focus__clickarea",_button:"image-focus__button"},_button:"button",button:{_primary:"button-primary",_disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,n){var i=this;i.$el=t(a),i.el=a,i.$el.data("imageFocus.focusPoint",i);var c,s;i.init=function(){i.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,n),i.addInterfaceElements(),i.attachment.init(),i.focusInterface.init(),i.cropButton.init(),t(e).on("resize",i.attachment.updateDimensionData)},i.addInterfaceElements=function(){var e,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(o.imageFocus._img),a.wrap('<div class="'+o._imageFocus+'"><div class="'+o.imageFocus._wrapper+'"></div></div>'),(e=t("."+o.imageFocus._wrapper)).append('<div class="'+o.imageFocus._point+'"></div>'),e.append('<div class="'+o.imageFocus._clickarea+'"></div>'),c=t("."+o._imageFocus),s=t("."+o.imageFocus._clickarea)},i.attachment={$el:!1,_id:!1,_width:!1,_height:!1,_offset:{x:!1,y:!1},_focusPoint:{x:50,y:50},init:function(){i.attachment.$el=t("."+o.imageFocus._img),i.attachment.getData(),i.attachment.$el.load(function(){i.attachment.updateDimensionData()})},getData:function(){i.attachment._id=t(i.el).data("id");var e={id:i.attachment._id};t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:e},dataType:"json"}).always(function(t){if(!0===t.success)try{if(!t.focusPoint.hasOwnProperty("x")||!t.focusPoint.hasOwnProperty("y"))throw"Wrong object properties";i.attachment._focusPoint=t.focusPoint}catch(t){console.log(t)}i.attachment.updateDimensionData(),i.focusInterface.updateStylePosition(),i.focusInterface.$el.css({display:"block"}),i.focusInterface.updateDimensionData(),i.focusInterface.updateStyleBackground()})},updateDimensionData:function(){var t=i.attachment.$el;i.attachment._width=t.width(),i.attachment._height=t.height(),i.attachment._offset.x=t.offset().left,i.attachment._offset.y=t.offset().top}},i.focusInterface={$el:!1,_width:0,_height:0,_radius:0,_offset:{x:0,y:0},_position:{x:0,y:0},_clickPosition:{x:0,y:0},_state:{move:!1,active:!1,hover:!1},init:function(){i.focusInterface.$el=t("."+o.imageFocus._point),s.on("mousedown",function(t){1===t.which&&i.focusInterface.startMove(t,!0).move(t)}),i.focusInterface.$el.on("mousedown",function(t){1===t.which&&i.focusInterface.startMove(t)}).on("mouseenter",function(){i.focusInterface.state.hover(!0)}).on("mouseleave",function(){i.focusInterface.state.hover(!1)}),t(e).on("mouseup",function(t){1===t.which&&(i.focusInterface._state.move=!1,i.focusInterface._state.active=!1,c.removeClass("is-active"))}).on("mousemove",function(t){i.focusInterface.move(t)}).on("resize",function(){i.focusInterface.updateDimensionData().updateStyle()})},startMove:function(t,e){return i.attachment.updateDimensionData(),i.focusInterface.updateDimensionData().updateClickPosition(t,e),i.cropButton.highlight(),c.addClass("is-active"),i.focusInterface._state.move=!0,i.focusInterface._state.active=!0,this},move:function(t){if(!1===i.focusInterface._state.move)return!1;var e={x:t.pageX,y:t.pageY},a={},o=i.attachment._offset,n=i.focusInterface._clickPosition;a.x=e.x-o.x-n.x,a.y=e.y-o.y-n.y,a.x=u.calc.maxRange(a.x,0,i.attachment._width),a.y=u.calc.maxRange(a.y,0,i.attachment._height);var c={};return c.x=a.x/i.attachment._width*100,c.y=a.y/i.attachment._height*100,i.attachment._focusPoint=c,i.focusInterface._position=a,i.focusInterface.updateStyle(),this},updateStyle:function(){return i.focusInterface.updateStylePosition(),i.focusInterface.updateStyleBackground(),this},updateStylePosition:function(){return i.focusInterface.$el.css({left:i.attachment._focusPoint.x+"%",top:i.attachment._focusPoint.y+"%"}),this},updateStyleBackground:function(){var t=0-(i.focusInterface._position.x-i.focusInterface._radius),e=0-(i.focusInterface._position.y-i.focusInterface._radius);return i.focusInterface.$el.css({backgroundImage:'url("'+i.attachment.$el.attr("src")+'")',backgroundSize:i.attachment._width+"px "+i.attachment._height+"px ",backgroundPosition:t+"px "+e+"px "}),this},updateClickPosition:function(t,e){var a={x:0,y:0};if(!0!==e){var o={x:t.pageX,y:t.pageY},n=i.focusInterface._offset;(a={}).x=o.x-n.x,a.y=o.y-n.y}return i.focusInterface._clickPosition=a,this},updateDimensionData:function(){i.focusInterface._width=i.focusInterface.$el.width(),i.focusInterface._height=i.focusInterface.$el.height();var t=i.focusInterface._width/2;i.focusInterface._radius=t;var e=i.focusInterface.$el.offset();return i.focusInterface._offset={x:e.left+t,y:e.top+t},i.focusInterface._position={x:i.attachment._focusPoint.x/100*i.attachment._width,y:i.attachment._focusPoint.y/100*i.attachment._height},this},state:{hover:function(t){i.focusInterface._state.hover=t,c.toggleClass("is-hover",t)}}},i.cropButton={$el:!1,_ajaxState:!1,init:function(){var e='<button type="button" class="'+o._button+" "+o.button._disabled+" crop-attachment "+o.imageFocus._button+'">'+focusPointL10n.cropButton+"</button>";t(i.el).find(".attachment-actions").append(e),i.cropButton.$el=t("."+o.imageFocus._button),i.cropButton.$el.on("click",i.sendImageCropDataByAjax)},highlight:function(){i.cropButton.$el.removeClass(o.button._disabled).addClass(o.button._primary).text(focusPointL10n.cropButton)},activate:function(){i.cropButton.$el.removeClass(o.button._disabled).removeClass(o.button._primary)},disable:function(){i.cropButton.$el.removeClass(o.button._primary).addClass(o.button._disabled)}},i.sendImageCropDataByAjax=function(){var e={id:i.attachment._id,focusPoint:i.attachment._focusPoint};t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:e},dataType:"json",beforeSend:function(){if(!0===i.cropButton._ajaxState)return!1;i.cropButton.$el.text("Cropping..."),i.cropButton.disable(),i.cropButton._ajaxState=!0}}).always(function(t){var e="Done";!0!==t.success&&(i.cropButton.activate(),e="Please try again"),i.cropButton.$el.text(e),i.cropButton._ajaxState=!1})};var u={};u.calc={maxRange:function(t,e,a){var o=t;return t<e?o=e:t>a&&(o=a),o}}},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(e){return this.each(function(){new t.imageFocus.focusPoint(this,e).init()})}}(jQuery,window,document),function(t,e,a){t(a).on("ready",function(){setInterval(function(){var e=t(".attachment-details");if(e.find(".details-image").length&&!t(".image-focus").length)try{e.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);
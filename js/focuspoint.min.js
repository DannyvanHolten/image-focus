!function(t, i) {
    "use strict";
    function e(t) {
        var i = t.find(".details-image");
        t.addClass("IFA-initialized");
        var e = new IFA.Models.Attachment({
            $el: t,
            $img: i
        }), o = (new IFA.Views.Attachment({
            model: e
        }), new IFA.Models.FocusInterface({}));
        new IFA.Views.FocusInterface({
            el: t.get(0),
            $el: t,
            model: o,
            attachment: e
        }, {
            $img: i
        });
        e.getStoredFocusPoint(), o.set("_state.init", !0);
    }
    i.IFA = {
        Models: {},
        Collections: {},
        Views: {}
    }, t(document).on("ready", function() {
        setInterval(function() {
            var i = t(".attachment-details");
            i.length && !t(".IFA-initialized").length && i.each(function() {
                e(t(this));
            });
        }, 500);
    });
}(jQuery, window), function(t, i) {
    "use strict";
    IFA.Models.Attachment = Backbone.Model.extend({
        $el: !1,
        $img: !1,
        _src: !1,
        _id: !1,
        _width: !1,
        _height: !1,
        _offset: {
            x: !1,
            y: !1
        },
        _focusPoint: {
            x: 50,
            y: 50
        },
        initialize: function(t) {
            console.log("init model attachment"), this.$el = t.$el, this.$img = t.$img, this._id = this.$el.data("id"), 
            this._src = this.$img.attr("src"), console.log(this._id);
        },
        getStoredFocusPoint: function() {
            console.log("getStoredFocusPoint");
            var i = this, e = {
                id: this._id
            };
            t.ajax({
                type: "POST",
                url: ajaxurl,
                data: {
                    action: "get-focuspoint",
                    attachment: e
                },
                dataType: "json"
            }).always(function(t) {
                if (!0 === t.success) try {
                    if (!t.focusPoint.hasOwnProperty("x") || !t.focusPoint.hasOwnProperty("y")) throw "Wrong object properties";
                    i.set("_focusPoint", t.focusPoint);
                } catch (t) {
                    console.log(t);
                }
            });
        }
    });
}(jQuery, window), function(t, i) {
    IFA.Models.FocusInterface = Backbone.Model.extend({
        _width: 0,
        _height: 0,
        _radius: 0,
        _offset: {
            x: 0,
            y: 0
        },
        _position: {
            x: 0,
            y: 0
        },
        _clickPosition: {
            x: 0,
            y: 0
        },
        _state: {
            init: !1,
            move: !1,
            active: !1,
            hover: !1
        },
        initialize: function() {
            console.log("initialize focuspoint");
        }
    });
}(jQuery, window), function(t, i) {
    "use strict";
    IFA.Views.Attachment = Backbone.View.extend({
        events: {
            resize: "updateDimensions"
        },
        initialize: function() {
            console.log("init view attachment");
            var e = this;
            t(i).on("resize", function() {
                e.updateDimensions();
            }), this.model.on("change:_focusPoint", this.updateDimensions, this);
        },
        updateDimensions: function() {
            console.log("attachment view: update dimensions");
            var t = this.model.$img;
            this.model._width = t.width(), this.model._height = t.height(), this.model._offset.x = t.offset().left, 
            this.model._offset.y = t.offset().top;
        },
        render: function() {
            return console.log("attachment view: render"), this;
        },
        remove: function() {
            t(i).off("resize", this.updateDimensions), Backbone.View.prototype.remove.apply(this, arguments);
        }
    });
}(jQuery, window), function(t, i) {
    "use strict";
    IFA.Views.FocusInterface = Backbone.View.extend({
        cssClass: {
            _imageFocus: "image-focus",
            imageFocus: {
                _wrapper: "image-focus__wrapper",
                _img: "image-focus__img",
                _point: "image-focus__point",
                _clickarea: "image-focus__clickarea",
                _button: "image-focus__button"
            }
        },
        template: !1,
        $img: !1,
        imgHtml: !1,
        $imageFocus: !1,
        $container: !1,
        $clickarea: !1,
        $focusPoint: !1,
        initialize: function(t, i) {
            console.log("focusinterface view: initialize");
            this.attachment = t.attachment, this.template = wp.template("IFA-focus-point"), 
            this.$img = i.$img, this.$img.addClass(this.cssClass.imageFocus._img), this.imgHtml = this.$img.get(0).outerHTML, 
            this.$img.wrap('<div class="IFA-container"></div>'), this.$container = this.$el.find(".IFA-container"), 
            this.render();
        },
        events: {},
        render: function() {
            console.log("focusinterface view: render"), this.$container.html(this.template({
                imageObject: this.imgHtml,
                left: this.attachment._focusPoint.x,
                top: this.attachment._focusPoint.y,
                state: "is-initialized"
            })), this.setElements(), this.setEvents();
        },
        setElements: function() {
            this.$imageFocus = this.$container.find("." + this.cssClass._imageFocus), this.$clickarea = this.$container.find("." + this.cssClass.imageFocus._clickarea), 
            this.$focusPoint = this.$container.find("." + this.cssClass.imageFocus._point), 
            this.$img = this.$container.find("." + this.cssClass.imageFocus._img), this.attachment.$img = this.$container.find("." + this.cssClass.imageFocus._img);
        },
        setEvents: function() {
            var e = this;
            this.$clickarea.on("mousedown", function(t) {
                console.log("click area mousedown"), 1 === t.which && e.startMove(t, !0).move(t);
            }), this.$focusPoint.on("mousedown", function(t) {
                console.log("interface mousedown"), 1 === t.which && e.startMove(t);
            }).on("mouseenter", function() {
                e.model._state.hover = !1, e.$imageFocus.toggleClass("is-hover", !1);
            }).on("mouseleave", function() {
                e.model._state.hover = !1, e.$imageFocus.toggleClass("is-hover", !1);
            }), t(i).on("mouseup", function(t) {
                1 === t.which && (e.model._state.move = !1, e.model._state.active = !1, e.$imageFocus.removeClass("is-active"));
            }).on("mousemove", function(t) {
                e.move(t);
            }).on("resize", function() {
                e.updateDimensionData().updateStyle();
            });
        },
        startMove: function(t, i) {
            return this.updateDimensionData().updateClickPosition(t, i), this.model._state.move = !0, 
            this.model._state.active = !0, this;
        },
        move: function(t) {
            if (!1 === this.model._state.move) return !1;
            var i = {
                x: t.pageX,
                y: t.pageY
            }, e = {}, o = this.attachment._offset, s = this.model._clickPosition;
            e.x = i.x - o.x - s.x, e.y = i.y - o.y - s.y, e.x = this.helper.calc.maxRange(e.x, 0, this.attachment._width), 
            e.y = this.helper.calc.maxRange(e.y, 0, this.attachment._height);
            var n = {};
            return n.x = e.x / this.attachment._width * 100, n.y = e.y / this.attachment._height * 100, 
            this.attachment.set("_focusPoint", n), this.model.set("_position", e), this.updateStyle(), 
            this;
        },
        updateStyle: function() {
            return this.updateStylePosition(), this.updateStyleBackground(), this;
        },
        updateStylePosition: function() {
            return console.log("updateStylePosition"), console.log(this.attachment._focusPoint.x), 
            this.$focusPoint.css({
                left: this.attachment._focusPoint.x + "%",
                top: this.attachment._focusPoint.y + "%"
            }), this;
        },
        updateStyleBackground: function() {
            console.log("updateStyleBackground");
            var t = 0 - (this.model._position.x - this.model._radius);
            console.log(this.model._position.x + " - " + this.model._radius);
            var i = 0 - (this.model._position.y - this.model._radius);
            return this.$focusPoint.css({
                backgroundImage: 'url("' + this.attachment._src + '")',
                backgroundSize: this.attachment._width + "px " + this.attachment._height + "px ",
                backgroundPosition: t + "px " + i + "px "
            }), this;
        },
        updateClickPosition: function(t, i) {
            var e = {
                x: 0,
                y: 0
            };
            if (!0 !== i) {
                var o = {
                    x: t.pageX,
                    y: t.pageY
                }, s = this.model._offset;
                (e = {}).x = o.x - s.x, e.y = o.y - s.y;
            }
            return this.model._clickPosition = e, this;
        },
        updateDimensionData: function() {
            this.model._width = this.$focusPoint.width(), this.model._height = this.$focusPoint.height();
            var t = this.model._width / 2;
            this.model._radius = t;
            var i = this.$focusPoint.offset();
            return this.model._offset = {
                x: i.left + t,
                y: i.top + t
            }, this.model._position = {
                x: this.attachment._focusPoint.x / 100 * this.attachment._width,
                y: this.attachment._focusPoint.y / 100 * this.attachment._height
            }, this;
        },
        helper: {
            calc: {
                maxRange: function(t, i, e) {
                    var o = t;
                    return t < i ? o = i : t > e && (o = e), o;
                }
            }
        }
    });
}(jQuery, window);
//# sourceMappingURL=focuspoint.min.js.map